

{
  "rules": {
    "courses": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "bundles": {
       ".read": true,
       ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "programs": {
        ".read": true,
        ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "hero": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "users": {
      "$uid": {
        ".read": "auth != null && ($uid === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true || root.child('users').child($uid).child('portfolio').child('public').val() === true)",
        ".write": "auth != null && ($uid === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true)",
        "cohort": {
          ".read": "auth != null"
        },
        "purchasedCourses": {
           ".read": "auth != null && auth.uid === $uid"
        }
      },
      ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "calendarEvents": {
      ".read": true,
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "submissions": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["userId"],
      "$submissionId": {
        ".read": "root.child('submissions').child($submissionId).child('userId').val() === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true"
      }
    },
    "tutorSettings": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "tutorHistory": {
      "$userId": {
        ".read": "auth != null && (auth.uid === $userId || root.child('users').child(auth.uid).child('isAdmin').val() === true)",
        ".write": "auth != null && auth.uid === $userId"
      }
    },
    "discussions": {
      ".read": "auth != null",
      "threads": {
        "$courseId": {
          ".read": "auth != null",
          ".write": "auth != null",
          ".indexOn": "createdAt"
        }
      },
      "replies": {
        "$threadId": {
           ".read": "auth != null",
           ".write": "auth != null",
           ".indexOn": "createdAt"
        }
      }
    },
    "userNotes": {
        "$userId": {
            "$courseId": {
                ".read": "auth.uid === $userId",
                ".write": "auth.uid === $userId"
            }
        }
    },
    "analytics": {
        ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
        ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "apiKeys": {
        "$userId": {
            ".read": "auth != null && auth.uid === $userId",
            ".write": "auth != null && auth.uid === $userId"
        }
    },
    "apiUsage": {
      "$userId": {
        ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
        ".read": "auth != null && auth.uid === $userId"
      }
    },
    "webrtc-offers": {
        "live-session": {
          ".read": "auth != null",
          ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
        }
    },
    "webrtc-answers": {
        "live-session": {
          "$uid": {
            ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
            ".write": "auth != null && auth.uid == $uid"
          }
        }
    },
    "webrtc-candidates": {
        "live-session": {
          "admin": {
            "$studentId": {
              ".read": "auth != null && auth.uid === $studentId",
              ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
            }
          },
          "student": {
            "$uid": {
              ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
              ".write": "auth != null && auth.uid == $uid"
            }
          }
        }
    },
    "liveChat": {
        "$sessionId": {
            ".read": "auth != null",
            ".write": "auth != null"
        }
    },
    "courseFeedback": {
        "$courseId": {
          ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
          ".write": "auth != null"
        }
    },
    "projects": {
       ".read": true,
       "$courseId": {
           ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
       }
    },
    "permissionRequests": {
      ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
      "$requestId": {
          "status": {
            ".write": "auth.uid === 'YlyqSWedlPfEqI9LlGzjN7zlRtC2'"
          }
      }
    },
    "notifications": {
      ".read": "auth != null",
      ".write": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true"
    },
    "organizations": {
        ".read": "auth != null && root.child('users').child(auth.uid).child('isAdmin').val() === true",
        "$orgId": {
            // Allow the org owner or a site admin to read/write
            ".read": "auth != null && (data.child('ownerId').val() === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true)",
            ".write": "auth != null && (newData.child('ownerId').val() === auth.uid || root.child('users').child(auth.uid).child('isAdmin').val() === true)"
        },
         // Allow any authenticated user to create a new organization (on signup)
        ".write": "auth != null"
    },
    "invitations": {
        ".read": true, // Allow reading invitations to validate them
        ".write": "auth != null", // Only authenticated users (org admins) can create invitations
        "$inviteId": {
            // Only the creating org admin can write, anyone can read to validate
            ".write": "auth != null && root.child('organizations').child(newData.child('organizationId').val()).child('ownerId').val() === auth.uid"
        }
    }
  }
}
